#7.1特征点法
##7.1.1特征点
直观的提取特征的方法就是在不同图像间辨认角点，确认他们的对应关系：Harris角点，FAST角点，GFTT角点。
角点维持不稳定，设计了更为稳定的局部图像特征：SIFT、SURF、ORB。
人工设计的特征点有如下性质：
1.可重复性
2.可区别性
3.高效性
4.本地性
特征点由关键点和描述子组成：一般为提取特征点并计算描述子。
外观相似的特征应该具有相似的描述子，因此只要两个特征点的描述子在向量空间上的距离相近，就可以认为是同样的特征点。
##7.1.2ORB特征
- FAST关键点
1.在图像中选取像素$p$,假定他的亮度为$I_p$;
2.设置一个阈值$T$;
3.以像素$p$为中心，选取半径为3的圆上的16个像素点；
4.假如选取的圆上有连续$N$个点的亮度大于$I_p+T$或小于$I_p-T$，那么像素$p$可以认为是特征点；
5.循环以上四步，对每个像素执行相同的操作。
ORB针对FAST的弱点，添加了尺度和旋转的描述，尺度依靠图像金字塔，旋转依靠灰度质心法。
- BRIEF描述子
BRIEF是一种二进制描述子，其描述向量有许多的0和1组成，这里的0和1编码了关键点附近两个随机像素（比如$p$和$q$）的大小关系：如果$p$比$q$大，则取1，反之取0。
##7.1.3特征匹配
- 暴力匹配：对每一个特征点$x_t^m$与所有的$x_{t+1}^n$测量描述子的距离，然后排序，取最近的一个作为匹配点。
- 快速近似最邻近

#7.3 2D-2D:对极几何
##7.3.1对极约束
若两个特征点完成匹配，则说明它们确实是同一个空间点在两个成像平面上的投影
相机中心与特征点连线的交点和相机中心构成极平面，相机中心连线称为基线，基线在两个像平面上的交点为极点，极平面与像平面的交线称为极线（实际上也是极点和特征点的连线）
设$P$的空间位置为：$P=[X,Y,Z]^T$,根据针孔相机模型，两个像素点$p_1,p_2$的像素位置为：
$$s_1p_1=KP, \  s_2p_2=K(RP+t)$$
其中$K$为相机内参矩阵，$R,t$为两个坐标系的相机运动。若使用齐次坐标系表示像素点，则两个投影关系为：
$$p_1\simeq KP , p_2\simeq K(RP+t)$$
取在归一化平面上的坐标$x_1,x_2$：
$$x_1=K^{-1}p_1, x_2=K^{-1}p_2$$
代入上式得：$x_2\simeq Rx_1+t$
两边同时左乘$t^{\wedge}$：
$$t^{\wedge}x_2\simeq t^{\wedge}Rx_1$$
两边同时左乘$x_2^T$,得到：
$$x_2^Tt^{\wedge}x_2\simeq x_2^Tt^{\wedge}Rx_1$$
$t^x_2$与$t$和$x_2$均垂直，因此上式与$x_2$做内积后仍为0，所以：
$$x_2^Tt^{\wedge}Rx_1=0$$
重新带入$p_1,p_2$则有：
$$p_2^TK^{-T}t^{\wedge}RK^{-1}p_1=0$$
把中间部分记为基础矩阵与本质矩阵：
$$E=t^{\wedge}R,F=K^{-T}EK^{-1},x_2^{T}Ex_1=p_2^TFp_2=0$$
因此相机的位姿估计问题变为以下几步：
1.根据配对点的像素位置求出$E$或者$F$；
2.根据$E$或者$F$求出$R,t$。
##7.3.2本质矩阵
- 本质矩阵是等式为零的约束，因此在不同的尺度下是等价的
- 本质矩阵的内在性质，其特异性必定是$[\sigma ,\sigma , 0]^T$
- 因为尺度等价性，故只存在5个自由度。

使用8点法求解本质矩阵
##7.3.3单应矩阵

#7.5三角测量
三角测量是指通过不同位置对同一个路标点进行观察，从观察到的位置推断路标点的距离。
按照对极几何，设$x_1,x_2$为两个特征点的归一化坐标：
$$s_2x_2=s_1Rx_1+t$$
$$s_2x_2^{\wedge}x_2=0=s_1x_2^{\wedge}Rx_1+x_2^{\wedge}t$$
#7.7 3D-2D:PnP
描述了当知道$n$个3D空间点及其投影位置时，如何估计相机的位姿。
使用3对点估计的P3P、直接线性变换(DLT)、EPnP、UPnP等
##7.7.1直接线性变换
##7.7.2P3P
利用三角形的相似性：
$$\begin{aligned}
x^2+y^2-2xycos<a,b>-v &=0 \\
y^2+1^2-2ycos<b,c>-uv &=0 \\
x^2+1^2-2xcos<a,c>-wv &=0
\end{aligned}
$$
其中$x=OA/OC,y=OB/OC,v=AB^2/OC^2,uv=BC^2/OC^2,wv=AC^2/OC^2$
$$(1-u)y^2-ux^2-cos<b,c>y+2uxycos<a,b>+1=0$$
$$(1-w)x^2-wy^2-cos<a,c>x+2wxycos<a,b>+1=0$$
##7.7.3最小化重投影误差求解PnP
把相机和三维点放在一起进行最小化的问题，统称为Bundle Adjustment
$$s_i \left [
    \begin{matrix}
    u_i \\
    v_i \\
    1
    \end{matrix}
    \right ] =KT \left[
        \begin{matrix}
        X_i \\
        Y_i \\
        Z_i \\
        1
        \end{matrix}
        \right]$$
写成矩阵形式为：$s_iu_i=KTP_i$
$$T^*=argmin_T \frac{1}{2}\sum_{i=1}^{n}||u_i-\frac{1}{s_i}KTP_i||_2^2$$

#7.9 3D-3D：ICP
##7.9.1 SVD方法
1.计算两组点的质心位置$p,p^{\prime}$,然后计算每个点的去质心坐标：
$$q_i=p_i-p,q_i^{\prime}, q_i^{\prime}=p_i^{\prime}-p^{\prime}$$
2.根据以下优化问题计算旋转矩阵:
$$R^*=arg min_R\frac{1}{2}\sum_{i=1}^n||q_i-Rq_i^{\prime}||^2$$
3.根据第2步的$R$计算$t$：
$$t^*=p-Rp^{\prime}$$
##7.9.2 非线性优化方法
以迭代的方式去寻找最优值。
