#11.1 概述
##11.1.1 回环检测的意义
只考虑相邻时间上的关键帧，则不可避免出现累计误差
后端可以估计最大后验误差，但仍不可避免累计误差
回环检测模块可以给出除了相邻帧的时隔更加久远的约束
##11.1.2 回环检测的方法
基于里程计的几何关系与基于外观的几何关系
##11.1.3 精确率和召回率
在SLAM中一般维持很高的精确率和较高的召回率。
#11.2 词袋模型
词袋的目的是用图像中有哪几种特征来描述一个图像
#11.3 字典
##11.3.1 字典的结构
字典的生成问题类似于一个聚类问题；
K-means聚类：
1.随机选取k个中心点:$c_1,\dots,c_k$;
2.对每一个样本，计算它与每一个中心点的距离，取最小的类作为归类；
3.重新计算每个类的中心点；
4.如果每个中心点的变化都很小，则算法收敛，退出，否则返回第2步。
#11.4 相似度计算
##11.4.1 理论部分
可以在建立字典时计算IDF:统计某个叶子节点$w_i$中的特征数量相对于所有特征数量的比例。假设所有特征数量为$n$,$w_i$数量为$n_i$
$$IDF_i=log\frac{n}{n_i}$$
TF部分是指某个特征在单幅图像中出现的频率。假设图像A中单词$w_i$出现了$n_i$次，而一共出现的单词次数为$n$。
$$TF_i = \frac{n_i}{n}$$
因此，$w_i$的权重等于TF与IDF的乘积:
$$\eta_i = TF_i \times IDF_i$$
考虑权重之后，对于某图像A，他的特征点可对应到很多个单词，组成他的BoW:
$$A=\{(w_1,\eta_1),(w_2,\eta_2),\dots,(w_N,\eta_N\}=v_a$$
#11.5 实验分析与评述
##11.5.1 增加字典规模
##11.5.2 相似性评分的处理
对于相似度比较大的区域，我们会取一个先验相似度$s(v_t,v_{t-\Delta t})$，他用来表示某时刻关键帧图像与上一个时刻关键帧的相似性。然后，其他的分值都参照这个值进行归一化：
$$s(v_t,v_{t_j})^{\prime}=s(v_t,v_{t_j})/s(v_t,v_{t-\Delta t})$$
在这个角度上，如果当前帧与之前某关键帧的相似度超过当前帧与上一个关键帧相似度的3倍，就认为可能存在回环，这个步骤避免了引入绝对的相似性阈值，使得算法能够适应更多的环境。
##11.5.3 关键帧的处理
从实践意义上来说，用于回环检测的帧最好稀疏一些，彼此之间不太相同，又能涵盖整个环境。
可以把“相近”的回环聚成一类，使算法不要反复检测同一类的回环。
##11.5.4 检测之后的验证
词袋的回环检测容易带来两个问题：外观相似的图片易被当成回环；词袋不在意单词顺序，容易引发感知偏差。
因此添加了验证步骤
一种方法是设立回环检测机制，另一种方法是空间上的一致性检测
